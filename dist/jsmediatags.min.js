(function(v){"object"===typeof exports&&"undefined"!==typeof module?module.exports=v():"function"===typeof define&&define.amd?define([],v):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).jsmediatags=v()})(function(){return function f(l,m,h){function k(a,b){if(!m[a]){if(!l[a]){var e="function"==typeof require&&require;if(!b&&e)return e(a,!0);if(d)return d(a,!0);e=Error("Cannot find module '"+a+"'");throw e.code="MODULE_NOT_FOUND",e;}e=m[a]=
{exports:{}};l[a][0].call(e.exports,function(b){var e=l[a][1][b];return k(e?e:b)},e,e.exports,f,l,m,h)}return m[a].exports}for(var d="function"==typeof require&&require,c=0;c<h.length;c++)k(h[c]);return k}({1:[function(f,l,m){},{}],2:[function(f,l,m){l.exports=XMLHttpRequest},{}],3:[function(f,l,m){function h(d,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);d.prototype=Object.create(c&&c.prototype,{constructor:{value:d,
enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(d,c):d.__proto__=c)}var k=function(){function d(c,a){for(var b=0;b<a.length;b++){var e=a[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(c,e.key,e)}}return function(c,a,b){a&&d(c.prototype,a);b&&d(c,b);return c}}();f=function(d){function c(a){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var b;b=Object.getPrototypeOf(c).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b._array=a;b._size=a.length;b._isInitialized=!0;return b}h(c,d);k(c,[{key:"init",value:function(a){setTimeout(a.onSuccess,0)}},{key:"loadRange",value:function(a,b){setTimeout(b.onSuccess,0)}},{key:"getByteAt",value:function(a){return this._array[a]}}],[{key:"canReadFile",value:function(a){return Array.isArray(a)||"function"===typeof Buffer&&Buffer.isBuffer(a)}}]);
return c}(f("./MediaFileReader"));l.exports=f},{"./MediaFileReader":10}],4:[function(f,l,m){function h(c,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);c.prototype=Object.create(a&&a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?Object.setPrototypeOf(c,a):c.__proto__=a)}var k=function(){function c(a,b){for(var e=0;e<b.length;e++){var g=b[e];g.enumerable=g.enumerable||
!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(a,b,e){b&&c(a.prototype,b);e&&c(a,e);return a}}(),d=f("./ChunkedFileData");f=function(c){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var e;e=Object.getPrototypeOf(a).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;e._blob=b;e._fileData=
new d;return e}h(a,c);k(a,[{key:"_init",value:function(b){this._size=this._blob.size;setTimeout(b.onSuccess,1)}},{key:"loadRange",value:function(b,a){var g=this,c=(this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice).call(this._blob,b[0],b[1]+1),d=new FileReader;d.onloadend=function(c){c=new Uint8Array(d.result);g._fileData.addData(b[0],c);a.onSuccess()};d.onerror=d.onabort=function(b){if(a.onError)a.onError({type:"blob",info:d.error})};d.readAsArrayBuffer(c)}},{key:"getByteAt",value:function(b){return this._fileData.getByteAt(b)}}],
[{key:"canReadFile",value:function(b){return"undefined"!==typeof Blob&&b instanceof Blob||"undefined"!==typeof File&&b instanceof File}}]);return a}(f("./MediaFileReader"));l.exports=f},{"./ChunkedFileData":5,"./MediaFileReader":10}],5:[function(f,l,m){var h=function(){function f(d,c){for(var a=0;a<c.length;a++){var b=c[a];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(d,b.key,b)}}return function(d,c,a){c&&f(d.prototype,c);a&&f(d,a);return d}}();
f=function(){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this._fileData=[]}h(f,null,[{key:"NOT_FOUND",get:function(){return-1}}]);h(f,[{key:"addData",value:function(d,c){var a=d+c.length-1,b=this._getChunkRange(d,a);if(-1===b.startIx)this._fileData.splice(b.insertIx||0,0,{offset:d,data:c});else{var e=this._fileData[b.startIx],g=this._fileData[b.endIx],a=a<g.offset+g.data.length-1,p={offset:Math.min(d,e.offset),data:c};d>e.offset&&(e=this._sliceData(e.data,
0,d-e.offset),p.data=this._concatData(e,c));a&&(e=this._sliceData(p.data,0,g.offset-p.offset),p.data=this._concatData(e,g.data));this._fileData.splice(b.startIx,b.endIx-b.startIx+1,p)}}},{key:"_concatData",value:function(d,c){if("undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView(d)){var a=new d.constructor(d.length+c.length);a.set(d,0);a.set(c,d.length);return a}return d.concat(c)}},{key:"_sliceData",value:function(d,c,a){return d.slice?d.slice(c,a):d.subarray(c,a)}},{key:"_getChunkRange",value:function(d,
c){for(var a=-1,b=-1,e=0,g=0;g<this._fileData.length;g++,e=g){var p=this._fileData[g].offset,q=p+this._fileData[g].data.length;if(c<p-1)break;if(d<=q+1&&c>=p-1){a=g;break}}if(-1===a)return{startIx:-1,endIx:-1,insertIx:e};for(g=a;g<this._fileData.length&&!(p=this._fileData[g].offset,q=p+this._fileData[g].data.length,c>=p-1&&(b=g),c<=q+1);g++);-1===b&&(b=a);return{startIx:a,endIx:b}}},{key:"hasDataRange",value:function(d,c){for(var a=0;a<this._fileData.length;a++){var b=this._fileData[a];if(c<b.offset)break;
if(d>=b.offset&&c<b.offset+b.data.length)return!0}return!1}},{key:"getByteAt",value:function(d){for(var c,a=0;a<this._fileData.length;a++){var b=this._fileData[a].offset,e=b+this._fileData[a].data.length-1;if(d>=b&&d<=e){c=this._fileData[a];break}}if(c)return c.data[d-c.offset];throw Error("Offset "+d+" hasn't been loaded yet.");}}]);return f}();l.exports=f},{}],6:[function(f,l,m){function h(c,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+
typeof a);c.prototype=Object.create(a&&a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?Object.setPrototypeOf(c,a):c.__proto__=a)}var k=function(){function c(a,b){for(var e=0;e<b.length;e++){var g=b[e];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(a,b,e){b&&c(a.prototype,b);e&&c(a,e);return a}}();m=f("./MediaTagReader");f("./MediaFileReader");f=function(c){function a(){if(!(this instanceof
a))throw new TypeError("Cannot call a class as a function");var b=Object.getPrototypeOf(a).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?this:b}h(a,c);k(a,[{key:"_loadData",value:function(b,a){var g=b.getSize();b.loadRange([g-128,g-1],a)}},{key:"_parseData",value:function(b,a){var g=b.getSize()-128,c=b.getStringWithCharsetAt(g+3,30).toString(),q=b.getStringWithCharsetAt(g+33,
30).toString(),r=b.getStringWithCharsetAt(g+63,30).toString(),f=b.getStringWithCharsetAt(g+93,4).toString(),u=b.getByteAt(g+97+28),n=b.getByteAt(g+97+29);if(0==u&&0!=n)var u="1.1",x=b.getStringWithCharsetAt(g+97,28).toString();else u="1.0",x=b.getStringWithCharsetAt(g+97,30).toString(),n=0;g=b.getByteAt(g+97+30);c={type:"ID3",version:u,tags:{title:c,artist:q,album:r,year:f,comment:x,genre:255>g?d[g]:""}};n&&(c.tags.track=n);return c}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,
length:128}}},{key:"canReadTagFormat",value:function(b){return"TAG"===String.fromCharCode.apply(String,b.slice(0,3))}}]);return a}(m);var d="Blues;Classic Rock;Country;Dance;Disco;Funk;Grunge;Hip-Hop;Jazz;Metal;New Age;Oldies;Other;Pop;R&B;Rap;Reggae;Rock;Techno;Industrial;Alternative;Ska;Death Metal;Pranks;Soundtrack;Euro-Techno;Ambient;Trip-Hop;Vocal;Jazz+Funk;Fusion;Trance;Classical;Instrumental;Acid;House;Game;Sound Clip;Gospel;Noise;AlternRock;Bass;Soul;Punk;Space;Meditative;Instrumental Pop;Instrumental Rock;Ethnic;Gothic;Darkwave;Techno-Industrial;Electronic;Pop-Folk;Eurodance;Dream;Southern Rock;Comedy;Cult;Gangsta;Top 40;Christian Rap;Pop/Funk;Jungle;Native American;Cabaret;New Wave;Psychadelic;Rave;Showtunes;Trailer;Lo-Fi;Tribal;Acid Punk;Acid Jazz;Polka;Retro;Musical;Rock & Roll;Hard Rock;Folk;Folk-Rock;National Folk;Swing;Fast Fusion;Bebob;Latin;Revival;Celtic;Bluegrass;Avantgarde;Gothic Rock;Progressive Rock;Psychedelic Rock;Symphonic Rock;Slow Rock;Big Band;Chorus;Easy Listening;Acoustic;Humour;Speech;Chanson;Opera;Chamber Music;Sonata;Symphony;Booty Bass;Primus;Porn Groove;Satire;Slow Jam;Club;Tango;Samba;Folklore;Ballad;Power Ballad;Rhythmic Soul;Freestyle;Duet;Punk Rock;Drum Solo;Acapella;Euro-House;Dance Hall".split(";");
l.exports=f},{"./MediaFileReader":10,"./MediaTagReader":11}],7:[function(f,l,m){function h(a){var b;switch(a){case 0:b="iso-8859-1";break;case 1:b="utf-16";break;case 2:b="utf-16be";break;case 3:b="utf-8"}return b}function k(a,b,e,g){g=e.getStringWithCharsetAt(a+1,b-1,g);a=e.getStringWithCharsetAt(a+1+g.bytesReadCount,b-1-g.bytesReadCount);return{user_description:g.toString(),data:a.toString()}}f("./MediaFileReader");var d={APIC:function(a,b,e,g,p){p=p||"3";g=a;var d=h(e.getByteAt(a));switch(p){case "2":p=
e.getStringAt(a+1,3);a+=4;break;case "3":case "4":p=e.getStringWithCharsetAt(a+1,b-1);a+=1+p.bytesReadCount;break;default:throw Error("Couldn't read ID3v2 major version.");}var r=e.getByteAt(a,1),r=c[r],d=e.getStringWithCharsetAt(a+1,b-(a-g)-1,d);a+=1+d.bytesReadCount;return{format:p.toString(),type:r,description:d.toString(),data:e.getBytesAt(a,g+b-a)}},COMM:function(a,b,e,g,c){var d=a,r=h(e.getByteAt(a));g=e.getStringAt(a+1,3);c=e.getStringWithCharsetAt(a+4,b-4,r);a+=4+c.bytesReadCount;a=e.getStringWithCharsetAt(a,
d+b-a,r);return{language:g,short_description:c.toString(),text:a.toString()}}};d.COM=d.COMM;d.PIC=function(a,b,e,g,c){return d.APIC(a,b,e,g,"2")};d.PCNT=function(a,b,e,g,c){return e.getLongAt(a,!1)};d.CNT=d.PCNT;d["T*"]=function(a,b,e,g,c){g=h(e.getByteAt(a));return e.getStringWithCharsetAt(a+1,b-1,g).toString()};d.TXXX=function(a,b,e,g,c){g=h(e.getByteAt(a));return k(a,b,e,g)};d["W*"]=function(a,b,e,g,c){g=h(e.getByteAt(a));return void 0!==g?k(a,b,e,g):e.getStringWithCharsetAt(a,b,g).toString()};
d.TCON=function(a,b,e,g){return d["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")};d.TCO=d.TCON;d.USLT=function(a,b,e,g,c){var d=a,r=h(e.getByteAt(a));g=e.getStringAt(a+1,3);c=e.getStringWithCharsetAt(a+4,b-4,r);a+=4+c.bytesReadCount;a=e.getStringWithCharsetAt(a,d+b-a,r);return{language:g,descriptor:c.toString(),lyrics:a.toString()}};d.ULT=d.USLT;var c="Other;32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. label side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";");
l.exports={getFrameReaderFunction:function(a){return a in d?d[a]:"T"===a[0]?d["T*"]:"W"===a[0]?d["W*"]:null}}},{"./MediaFileReader":10}],8:[function(f,l,m){function h(b,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?Object.setPrototypeOf(b,a):b.__proto__=a)}var k=function(){function b(a,
e){for(var c=0;c<e.length;c++){var d=e[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}();m=f("./MediaTagReader");f("./MediaFileReader");var d=f("./ArrayFileReader"),c=f("./ID3v2FrameReader");f=function(e){function g(){if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");var b=Object.getPrototypeOf(g).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?this:b}h(g,e);k(g,[{key:"_loadData",value:function(b,a){b.loadRange([6,9],{onSuccess:function(){b.loadRange([0,10+b.getSynchsafeInteger32At(6)-1],a)},onError:a.onError})}},{key:"_parseData",value:function(a,e){var c=0,g=a.getByteAt(c+3);if(4<g)return{type:"ID3",version:">2.4",tags:{}};var d=a.getByteAt(c+4),n=a.isBitSetAt(c+5,7),f=a.isBitSetAt(c+5,6),k=a.isBitSetAt(c+5,5),t=a.getSynchsafeInteger32At(c+6),c=c+10;if(f)var h=a.getLongAt(c,!0),c=c+
(h+4);var g={type:"ID3",version:"2."+g+"."+d,major:g,revision:d,flags:{unsynchronisation:n,extended_header:f,experimental_indicator:k,footer_present:!1},size:t,tags:{}},c=this._readFrames(c,t+10,a,g,e),l;for(l in b)b.hasOwnProperty(l)&&(t=this._getFrameData(c,b[l]))&&(g.tags[l]=t);for(var m in c)c.hasOwnProperty(m)&&(g.tags[m]=c[m]);return g}},{key:"_getUnsyncFileReader",value:function(b,a,c){b=b.getBytesAt(a,c);for(a=0;a<b.length-1;a++)255===b[a]&&0===b[a+1]&&b.splice(a+1,1);return new d(b)}},{key:"_readFrames",
value:function(b,a,e,g,d){var n={};for(d&&(d=this._expandShortcutTags(d));b<a;){var f=this._readFrameHeader(e,b,g),k=f.id;if(!k)break;var t=f.flags,l=f.size,h=b+f.headerSize,m=e;b+=f.headerSize+f.size;if(!d||-1!==d.indexOf(k)){if(g.flags.unsynchronisation||t&&t.format.unsynchronisation)m=this._getUnsyncFileReader(m,h,l),h=0,l=m.getSize();t&&t.format.data_length_indicator&&(h+=4,l-=4);t=(f=c.getFrameReaderFunction(k))?f(h,l,m,t):null;h=this._getFrameDescription(k);l={id:k,size:l,description:h,data:t};
k in n?(n[k].id&&(n[k]=[n[k]]),n[k].push(l)):n[k]=l}}return n}},{key:"_readFrameHeader",value:function(b,a,c){c=c.major;var e=null;switch(c){case 2:var g=b.getStringAt(a,3),d=b.getInteger24At(a+3,!0),f=6;break;case 3:g=b.getStringAt(a,4);d=b.getLongAt(a+4,!0);f=10;break;case 4:g=b.getStringAt(a,4),d=b.getSynchsafeInteger32At(a+4),f=10}if(g==String.fromCharCode(0,0,0)||g==String.fromCharCode(0,0,0,0))g="";g&&2<c&&(e=this._readFrameFlags(b,a+8));return{id:g||"",size:d||0,headerSize:f||0,flags:e}}},
{key:"_readFrameFlags",value:function(b,a){return{message:{tag_alter_preservation:b.isBitSetAt(a,6),file_alter_preservation:b.isBitSetAt(a,5),read_only:b.isBitSetAt(a,4)},format:{grouping_identity:b.isBitSetAt(a+1,7),compression:b.isBitSetAt(a+1,3),encryption:b.isBitSetAt(a+1,2),unsynchronisation:b.isBitSetAt(a+1,1),data_length_indicator:b.isBitSetAt(a+1,0)}}}},{key:"_getFrameData",value:function(b,a){for(var c=0,e;e=a[c];c++)if(e in b)return b[e].data}},{key:"_getFrameDescription",value:function(b){return b in
a?a[b]:"Unknown"}},{key:"getShortcuts",value:function(){return b}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(b){return"ID3"===String.fromCharCode.apply(String,b.slice(0,3))}}]);return g}(m);var a={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",
MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",
TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",
TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",
AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",
POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",
TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",
TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",
TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},b={title:["TIT2","TT2"],
artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};l.exports=f},{"./ArrayFileReader":3,"./ID3v2FrameReader":7,"./MediaFileReader":10,"./MediaTagReader":11}],9:[function(f,l,m){function h(b,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,
enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?Object.setPrototypeOf(b,a):b.__proto__=a)}var k=function(){function b(b,a){for(var c=0;c<a.length;c++){var d=a[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}();m=f("./MediaTagReader");f("./MediaFileReader");f=function(b){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");
var b=Object.getPrototypeOf(e).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?this:b}h(e,b);k(e,[{key:"_loadData",value:function(b,a){var c=this;b.loadRange([0,16],{onSuccess:function(){c._loadAtom(b,0,"",a)},onError:a.onError})}},{key:"_loadAtom",value:function(b,a,c,e){if(a>=b.getSize())e.onSuccess();else{var d=this,f=b.getLongAt(a,!0);if(0==f||isNaN(f))e.onSuccess();else{var n=
b.getStringAt(a+4,4);if(this._isContainerAtom(n)){"meta"==n&&(a+=4);var k=(c?c+".":"")+n;"moov.udta.meta.ilst"===k?b.loadRange([a,a+f],e):b.loadRange([a+8,a+8+8],{onSuccess:function(){d._loadAtom(b,a+8,k,e)},onError:e.onError})}else b.loadRange([a+f,a+f+8],{onSuccess:function(){d._loadAtom(b,a+f,c,e)},onError:e.onError})}}}},{key:"_isContainerAtom",value:function(b){return 0<=["moov","udta","meta","ilst"].indexOf(b)}},{key:"_canReadAtom",value:function(b){return"----"!==b}},{key:"_parseData",value:function(b,
c){var e={};c=this._expandShortcutTags(c);this._readAtom(e,b,0,b.getSize(),c);for(var d in a)if(a.hasOwnProperty(d)){var f=e[a[d]];f&&(e[d]="track"===d?f.data.track:f.data)}return{type:"MP4",ftyp:b.getStringAt(8,4),version:b.getLongAt(12,!0),tags:e}}},{key:"_readAtom",value:function(b,a,c,e,d,f,n){n=void 0===n?"":n+"  ";for(var k=c;k<c+e;){var l=a.getLongAt(k,!0);if(0==l)break;var h=a.getStringAt(k+4,4);if(this._isContainerAtom(h)){"meta"==h&&(k+=4);this._readAtom(b,a,k+8,l-8,d,(f?f+".":"")+h,n);
break}(!d||0<=d.indexOf(h))&&"moov.udta.meta.ilst"===f&&this._canReadAtom(h)&&(b[h]=this._readMetadataAtom(a,k));k+=l}}},{key:"_readMetadataAtom",value:function(b,a){var e=b.getLongAt(a,!0),f=b.getStringAt(a+4,4),k=b.getInteger24At(a+16+1,!0),k=d[k],h;if("trkn"==f)h={track:b.getByteAt(a+16+11),total:b.getByteAt(a+16+13)};else{var n=a+24,l=e-24;"covr"===f&&"uint8"===k&&(k="jpeg");switch(k){case "text":h=b.getStringWithCharsetAt(n,l,"utf-8").toString();break;case "uint8":h=b.getShortAt(n,!1);break;
case "jpeg":case "png":h={format:"image/"+k,data:b.getBytesAt(n,l)}}}return{id:f,size:e,description:c[f]||"Unknown",data:h}}},{key:"getShortcuts",value:function(){return a}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(b){return"ftyp"===String.fromCharCode.apply(String,b.slice(4,8))}}]);return e}(m);var d={0:"uint8",1:"text",13:"jpeg",14:"png",21:"uint8"},c={"\u00a9alb":"Album","\u00a9ART":"Artist",aART:"Album Artist","\u00a9day":"Release Date",
"\u00a9nam":"Title","\u00a9gen":"Genre",gnre:"Genre",trkn:"Track Number","\u00a9wrt":"Composer","\u00a9too":"Encoding Tool","\u00a9enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","\u00a9grp":"Grouping",keyw:"Keywords","\u00a9lyr":"Lyrics","\u00a9cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",
soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code"},a={title:"\u00a9nam",artist:"\u00a9ART",album:"\u00a9alb",year:"\u00a9day",comment:"\u00a9cmt",track:"trkn",genre:"\u00a9gen",picture:"covr",lyrics:"\u00a9lyr"};l.exports=f},{"./MediaFileReader":10,"./MediaTagReader":11}],10:[function(f,l,m){var h=function(){function d(c,
a){for(var b=0;b<a.length;b++){var e=a[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(c,e.key,e)}}return function(c,a,b){a&&d(c.prototype,a);b&&d(c,b);return c}}(),k=f("./StringUtils");f=function(){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");this._isInitialized=!1;this._size=0}h(d,[{key:"init",value:function(c){var a=this;if(this._isInitialized)setTimeout(c.onSuccess,1);else return this._init({onSuccess:function(){a._isInitialized=
!0;c.onSuccess()},onError:c.onError})}},{key:"_init",value:function(c){throw Error("Must implement init function");}},{key:"loadRange",value:function(c,a){throw Error("Must implement loadRange function");}},{key:"getSize",value:function(){if(!this._isInitialized)throw Error("init() must be called first.");return this._size}},{key:"getByteAt",value:function(c){throw Error("Must implement getByteAt function");}},{key:"getBytesAt",value:function(c,a){for(var b=Array(a),e=0;e<a;e++)b[e]=this.getByteAt(c+
e);return b}},{key:"isBitSetAt",value:function(c,a){return 0!=(this.getByteAt(c)&1<<a)}},{key:"getSByteAt",value:function(c){c=this.getByteAt(c);return 127<c?c-256:c}},{key:"getShortAt",value:function(c,a){var b=a?(this.getByteAt(c)<<8)+this.getByteAt(c+1):(this.getByteAt(c+1)<<8)+this.getByteAt(c);0>b&&(b+=65536);return b}},{key:"getSShortAt",value:function(c,a){var b=this.getShortAt(c,a);return 32767<b?b-65536:b}},{key:"getLongAt",value:function(c,a){var b=this.getByteAt(c),e=this.getByteAt(c+1),
d=this.getByteAt(c+2),f=this.getByteAt(c+3),b=a?(((b<<8)+e<<8)+d<<8)+f:(((f<<8)+d<<8)+e<<8)+b;0>b&&(b+=4294967296);return b}},{key:"getSLongAt",value:function(c,a){var b=this.getLongAt(c,a);return 2147483647<b?b-4294967296:b}},{key:"getInteger24At",value:function(c,a){var b=this.getByteAt(c),e=this.getByteAt(c+1),d=this.getByteAt(c+2),b=a?((b<<8)+e<<8)+d:((d<<8)+e<<8)+b;0>b&&(b+=16777216);return b}},{key:"getStringAt",value:function(c,a){for(var b=[],e=c,d=0;e<c+a;e++,d++)b[d]=String.fromCharCode(this.getByteAt(e));
return b.join("")}},{key:"getStringWithCharsetAt",value:function(c,a,b){c=this.getBytesAt(c,a);switch((b||"").toLowerCase()){case "utf-16":case "utf-16le":case "utf-16be":b=k.readUTF16String(c,"utf-16be"===b);break;case "utf-8":b=k.readUTF8String(c);break;default:b=k.readNullTerminatedString(c)}return b}},{key:"getCharAt",value:function(c){return String.fromCharCode(this.getByteAt(c))}},{key:"getSynchsafeInteger32At",value:function(c){var a=this.getByteAt(c),b=this.getByteAt(c+1),e=this.getByteAt(c+
2);return this.getByteAt(c+3)&127|(e&127)<<7|(b&127)<<14|(a&127)<<21}}],[{key:"canReadFile",value:function(c){throw Error("Must implement canReadFile function");}}]);return d}();l.exports=f},{"./StringUtils":12}],11:[function(f,l,m){var h=function(){function f(d,c){for(var a=0;a<c.length;a++){var b=c[a];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(d,b.key,b)}}return function(d,c,a){c&&f(d.prototype,c);a&&f(d,a);return d}}();f("./MediaFileReader");
f=function(){function f(d){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this._mediaFileReader=d;this._tags=null}h(f,[{key:"setTagsToRead",value:function(d){this._tags=d;return this}},{key:"read",value:function(d){var c=this;this._mediaFileReader.init({onSuccess:function(){c._loadData(c._mediaFileReader,{onSuccess:function(){try{var a=c._parseData(c._mediaFileReader,c._tags)}catch(b){if(d.onError){d.onError({type:"parseData",info:b.message});return}}d.onSuccess(a)},
onError:d.onError})},onError:d.onError})}},{key:"getShortcuts",value:function(){return{}}},{key:"_loadData",value:function(d,c){throw Error("Must implement _loadData function");}},{key:"_parseData",value:function(d,c){throw Error("Must implement _parseData function");}},{key:"_expandShortcutTags",value:function(d){if(!d)return null;for(var c=[],a=this.getShortcuts(),b=0,e;e=d[b];b++)c=c.concat(a[e]||[e]);return c}}],[{key:"getTagIdentifierByteRange",value:function(){throw Error("Must implement");
}},{key:"canReadTagFormat",value:function(d){throw Error("Must implement");}}]);return f}();l.exports=f},{"./MediaFileReader":10}],12:[function(f,l,m){var h=function(){function d(c,a){for(var b=0;b<a.length;b++){var e=a[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(c,e.key,e)}}return function(c,a,b){a&&d(c.prototype,a);b&&d(c,b);return c}}(),k=function(){function d(c,a){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");
this._value=c;this.bytesReadCount=a;this.length=c.length}h(d,[{key:"toString",value:function(){return this._value}}]);return d}();l.exports={readUTF16String:function(d,c,a){var b=0,e=1,g=0;a=Math.min(a||d.length,d.length);254==d[0]&&255==d[1]?(c=!0,b=2):255==d[0]&&254==d[1]&&(c=!1,b=2);c&&(e=0,g=1);c=[];for(var f=0;b<a;f++){var h=d[b+e],l=(h<<8)+d[b+g],b=b+2;if(0==l)break;else 216>h||224<=h?c[f]=String.fromCharCode(l):(h=(d[b+e]<<8)+d[b+g],b+=2,c[f]=String.fromCharCode(l,h))}return new k(c.join(""),
b)},readUTF8String:function(d,c){var a=0;c=Math.min(c||d.length,d.length);239==d[0]&&187==d[1]&&191==d[2]&&(a=3);for(var b=[],e=0;a<c;e++){var g=d[a++];if(0==g)break;else if(128>g)b[e]=String.fromCharCode(g);else if(194<=g&&224>g){var f=d[a++];b[e]=String.fromCharCode(((g&31)<<6)+(f&63))}else if(224<=g&&240>g){var f=d[a++],h=d[a++];b[e]=String.fromCharCode(((g&255)<<12)+((f&63)<<6)+(h&63))}else if(240<=g&&245>g){var f=d[a++],h=d[a++],l=d[a++],g=((g&7)<<18)+((f&63)<<12)+((h&63)<<6)+(l&63)-65536;b[e]=
String.fromCharCode((g>>10)+55296,(g&1023)+56320)}}return new k(b.join(""),a)},readNullTerminatedString:function(d,c){var a=[];c=c||d.length;for(var b=0;b<c;){var e=d[b++];if(0==e)break;a[b-1]=String.fromCharCode(e)}return new k(a.join(""),b)}}},{}],13:[function(f,l,m){function h(c,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);c.prototype=Object.create(a&&a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});
a&&(Object.setPrototypeOf?Object.setPrototypeOf(c,a):c.__proto__=a)}var k=function(){function c(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,b,e){b&&c(a.prototype,b);e&&c(a,e);return a}}(),d=f("./ChunkedFileData");m=function(c){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var c;c=Object.getPrototypeOf(a).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c._url=b;c._fileData=new d;return c}h(a,c);k(a,[{key:"_init",value:function(b){a._config.avoidHeadRequests?this._fetchSizeWithGetRequest(b):this._fetchSizeWithHeadRequest(b)}},{key:"_fetchSizeWithHeadRequest",value:function(b){var a=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(c){(c=a._parseContentLength(c))?(a._size=c,b.onSuccess()):a._fetchSizeWithGetRequest(b)},onError:b.onError})}},{key:"_fetchSizeWithGetRequest",value:function(b){var a=
this,c=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",c,{onSuccess:function(c){var d=a._parseContentRange(c);c=a._getXhrResponseContent(c);if(d){if(null==d.instanceLength){a._fetchEntireFile(b);return}a._size=d.instanceLength}else a._size=c.length;a._fileData.addData(0,c);b.onSuccess()},onError:b.onError})}},{key:"_fetchEntireFile",value:function(b){var a=this;this._makeXHRRequest("GET",null,{onSuccess:function(c){c=a._getXhrResponseContent(c);a._size=c.length;a._fileData.addData(0,
c);b.onSuccess()},onError:b.onError})}},{key:"_getXhrResponseContent",value:function(b){return b.responseBody||b.responseText||""}},{key:"_parseContentLength",value:function(b){b=this._getResponseHeader(b,"Content-Length");return null==b?b:parseInt(b,10)}},{key:"_parseContentRange",value:function(b){if(b=this._getResponseHeader(b,"Content-Range")){var a=b.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!a)throw Error("FIXME: Unknown Content-Range syntax: ",b);return{firstBytePosition:parseInt(a[1],10),
lastBytePosition:parseInt(a[2],10),instanceLength:a[3]?parseInt(a[3],10):null}}return null}},{key:"loadRange",value:function(b,a){var c=this;c._fileData.hasDataRange(b[0],Math.min(c._size,b[1]))?setTimeout(a.onSuccess,1):(b=this._roundRangeToChunkMultiple(b),b[1]=Math.min(c._size,b[1]),this._makeXHRRequest("GET",b,{onSuccess:function(d){d=c._getXhrResponseContent(d);c._fileData.addData(b[0],d);a.onSuccess()},onError:a.onError}))}},{key:"_roundRangeToChunkMultiple",value:function(b){return[b[0],b[0]+
1024*Math.ceil((b[1]-b[0]+1)/1024)-1]}},{key:"_makeXHRRequest",value:function(b,c,d){var f=this._createXHRObject(),h=function(){if(200===f.status||206===f.status)d.onSuccess(f);else if(d.onError)d.onError({type:"xhr",info:"Unexpected HTTP status "+f.status+".",xhr:f});f=null};"undefined"!==typeof f.onload?(f.onload=h,f.onerror=function(){if(d.onError)d.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:f})}):f.onreadystatechange=function(){4===f.readyState&&h()};a._config.timeoutInSec&&
(f.timeout=1E3*a._config.timeoutInSec,f.ontimeout=function(){if(d.onError)d.onError({type:"xhr",info:"Timeout after "+f.timeout/1E3+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:f})});f.open(b,this._url);f.overrideMimeType("text/plain; charset=x-user-defined");c&&this._setRequestHeader(f,"Range","bytes="+c[0]+"-"+c[1]);this._setRequestHeader(f,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT");f.send(null)}},{key:"_setRequestHeader",value:function(b,c,d){0>a._config.disallowedXhrHeaders.indexOf(c.toLowerCase())&&
b.setRequestHeader(c,d)}},{key:"_hasResponseHeader",value:function(b,a){var c=b.getAllResponseHeaders();if(!c)return!1;for(var c=c.split("\r\n"),d=[],f=0;f<c.length;f++)d[f]=c[f].split(":")[0].toLowerCase();return 0<=d.indexOf(a.toLowerCase())}},{key:"_getResponseHeader",value:function(b,a){return this._hasResponseHeader(b,a)?b.getResponseHeader(a):null}},{key:"getByteAt",value:function(b){return this._fileData.getByteAt(b).charCodeAt(0)&255}},{key:"_createXHRObject",value:function(){if("undefined"===
typeof window)return new (f("xhr2").XMLHttpRequest);if(window.XMLHttpRequest)return new window.XMLHttpRequest;throw Error("XMLHttpRequest is not supported");}}],[{key:"canReadFile",value:function(b){return"string"===typeof b&&/^[a-z]+:\/\//i.test(b)}},{key:"setConfig",value:function(b){for(var a in b)b.hasOwnProperty(a)&&(this._config[a]=b[a]);b=this._config.disallowedXhrHeaders;for(a=0;a<b.length;a++)b[a]=b[a].toLowerCase()}}]);return a}(f("./MediaFileReader"));m._config={avoidHeadRequests:!1,disallowedXhrHeaders:[],
timeoutInSec:30};l.exports=m},{"./ChunkedFileData":5,"./MediaFileReader":10,xhr2:2}],14:[function(f,l,m){function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function k(a,b){var c=0>a.offset&&(-a.offset>b||0<a.offset+a.length);return!(0<=a.offset&&a.offset+a.length>=b||c)}var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();f("./MediaFileReader");m=f("./NodeFileReader");var c=f("./XhrFileReader"),a=f("./BlobFileReader"),b=f("./ArrayFileReader");f("./MediaTagReader");var e=f("./ID3v1TagReader"),g=f("./ID3v2TagReader");f=f("./MP4TagReader");var p=[],q=[],r=function(){function a(b){h(this,a);this._file=b}d(a,[{key:"setTagsToRead",value:function(a){this._tagsToRead=a;return this}},{key:"setFileReader",value:function(a){this._fileReader=a;return this}},{key:"setTagReader",value:function(a){this._tagReader=
a;return this}},{key:"read",value:function(a){var b=new (this._getFileReader())(this._file),c=this;b.init({onSuccess:function(){c._getTagReader(b,{onSuccess:function(d){(new d(b)).setTagsToRead(c._tagsToRead).read(a)},onError:a.onError})},onError:a.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var a=0;a<p.length;a++)if(p[a].canReadFile(this._file))return p[a];throw Error("No suitable file reader found for ",
this._file);}},{key:"_getTagReader",value:function(a,b){if(this._tagReader){var c=this._tagReader;setTimeout(function(){b.onSuccess(c)},1)}else this._findTagReader(a,b)}},{key:"_findTagReader",value:function(a,b){for(var c=[],d=[],e=a.getSize(),f=0;f<q.length;f++){var g=q[f].getTagIdentifierByteRange();k(g,e)&&(0<=g.offset&&g.offset<e/2||0>g.offset&&g.offset<-e/2?c.push(q[f]):d.push(q[f]))}var h=!1,f={onSuccess:function(){if(h){for(var c=0;c<q.length;c++){var d=q[c].getTagIdentifierByteRange();if(k(d,
e)){try{var f=a.getBytesAt(0<=d.offset?d.offset:d.offset+e,d.length)}catch(g){if(b.onError){b.onError({type:"fileReader",info:g.message});return}}if(q[c].canReadTagFormat(f)){b.onSuccess(q[c]);return}}}if(b.onError)b.onError({type:"tagFormat",info:"No suitable tag reader found"})}else h=!0},onError:b.onError};this._loadTagIdentifierRanges(a,c,f);this._loadTagIdentifierRanges(a,d,f)}},{key:"_loadTagIdentifierRanges",value:function(a,b,c){if(0===b.length)setTimeout(c.onSuccess,1);else{for(var d=[Number.MAX_VALUE,
0],e=a.getSize(),f=0;f<b.length;f++){var g=b[f].getTagIdentifierByteRange(),h=0<=g.offset?g.offset:g.offset+e,g=h+g.length-1;d[0]=Math.min(h,d[0]);d[1]=Math.max(g,d[1])}a.loadRange(d,c)}}}]);return a}(),w=function(){function a(){h(this,a)}d(a,null,[{key:"addFileReader",value:function(b){p.push(b);return a}},{key:"addTagReader",value:function(b){q.push(b);return a}},{key:"removeTagReader",value:function(b){b=q.indexOf(b);0<=b&&q.splice(b,1);return a}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function(){c.setConfig({avoidHeadRequests:!0})}},
{key:"setDisallowedXhrHeaders",value:function(a){c.setConfig({disallowedXhrHeaders:a})}},{key:"setXhrTimeoutInSec",value:function(a){c.setConfig({timeoutInSec:a})}}]);return a}();w.addFileReader(c).addFileReader(a).addFileReader(b).addTagReader(g).addTagReader(e).addTagReader(f);"undefined"!==typeof process&&w.addFileReader(m);l.exports={read:function(a,b){(new r(a)).read(b)},Reader:r,Config:w}},{"./ArrayFileReader":3,"./BlobFileReader":4,"./ID3v1TagReader":6,"./ID3v2TagReader":8,"./MP4TagReader":9,
"./MediaFileReader":10,"./MediaTagReader":11,"./NodeFileReader":1,"./XhrFileReader":13}]},{},[14])(14)});
