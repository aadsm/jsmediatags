(function(v){"object"===typeof exports&&"undefined"!==typeof module?module.exports=v():"function"===typeof define&&define.amd?define([],v):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).jsmediatags=v()})(function(){return function e(k,m,l){function h(a,c){if(!m[a]){if(!k[a]){var d="function"==typeof require&&require;if(!c&&d)return d(a,!0);if(f)return f(a,!0);d=Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d;}d=m[a]=
{exports:{}};k[a][0].call(d.exports,function(c){var d=k[a][1][c];return h(d?d:c)},d,d.exports,e,k,m,l)}return m[a].exports}for(var f="function"==typeof require&&require,a=0;a<l.length;a++)h(l[a]);return h}({1:[function(e,k,m){},{}],2:[function(e,k,m){k.exports=XMLHttpRequest},{}],3:[function(e,k,m){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,c){for(var d=0;d<c.length;d++){var g=c[d];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();e("./FlowTypes");var f=e("./ChunkedFileData");e=function(a){function b(c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
var a;a=Object.getPrototypeOf(b).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a._blob=c;a._fileData=new f;return a}l(b,a);h(b,[{key:"_init",value:function(c){this._size=this._blob.size;setTimeout(c.onSuccess,1)}},{key:"loadRange",value:function(c,a){var g=this,b=(this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice).call(this._blob,c[0],c[1]+1),n=new FileReader;n.onloadend=
function(b){b=new Uint8Array(n.result);g._fileData.addData(c[0],b);a.onSuccess()};n.onerror=n.onabort=function(c){if(a.onError)a.onError({type:"blob",info:n.error})};n.readAsArrayBuffer(b)}},{key:"getByteAt",value:function(c){return this._fileData.getByteAt(c)}}],[{key:"canReadFile",value:function(c){return"undefined"!==typeof Blob&&c instanceof Blob}}]);return b}(e("./MediaFileReader"));k.exports=e},{"./ChunkedFileData":4,"./FlowTypes":5,"./MediaFileReader":10}],4:[function(e,k,m){var l=function(){function e(f,
a){for(var b=0;b<a.length;b++){var c=a[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(f,c.key,c)}}return function(f,a,b){a&&e(f.prototype,a);b&&e(f,b);return f}}();e("./FlowTypes");e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._fileData=[]}l(e,null,[{key:"NOT_FOUND",get:function(){return-1}}]);l(e,[{key:"addData",value:function(f,a){var b=f+a.length-1,c=this._getChunkRange(f,b);
if(-1===c.startIx)this._fileData.splice(c.insertIx||0,0,{offset:f,data:a});else{var d=this._fileData[c.startIx],g=this._fileData[c.endIx],b=b<g.offset+g.data.length-1,p={offset:Math.min(f,d.offset),data:a};f>d.offset&&(d=d.data.slice(0,f-d.offset),p.data=this._concatData(d,a));b&&(d=p.data.slice(0,g.offset-p.offset),p.data=this._concatData(d,g.data));this._fileData.splice(c.startIx,c.endIx-c.startIx+1,p)}}},{key:"_concatData",value:function(f,a){if("undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView(f)){var b=
new f.constructor(f.length+a.length);b.set(f,0);b.set(a,f.length);return b}return f.concat(a)}},{key:"_getChunkRange",value:function(f,a){for(var b=-1,c=-1,d=0,g=0;g<this._fileData.length;g++,d=g){var p=this._fileData[g].offset,n=p+this._fileData[g].data.length;if(a<p-1)break;if(f<=n+1&&a>=p-1){b=g;break}}if(-1===b)return{startIx:-1,endIx:-1,insertIx:d};for(g=b;g<this._fileData.length&&!(p=this._fileData[g].offset,n=p+this._fileData[g].data.length,a>=p-1&&(c=g),a<=n+1);g++);-1===c&&(c=b);return{startIx:b,
endIx:c}}},{key:"hasDataRange",value:function(f,a){for(var b=0;b<this._fileData.length;b++){var c=this._fileData[b];if(a<c.offset)break;if(f>=c.offset&&a<c.offset+c.data.length)return!0}return!1}},{key:"getByteAt",value:function(f){for(var a,b=0;b<this._fileData.length;b++){var c=this._fileData[b].offset,d=c+this._fileData[b].data.length-1;if(f>=c&&f<=d){a=this._fileData[b];break}}if(a)return a.data[f-a.offset];throw Error("Offset "+f+" hasn't been loaded yet.");}}]);return e}();k.exports=e},{"./FlowTypes":5}],
5:[function(e,k,m){e("./MediaFileReader")},{"./MediaFileReader":10}],6:[function(e,k,m){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,c){for(var d=0;d<c.length;d++){var g=c[d];g.enumerable=g.enumerable||
!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();e("./FlowTypes");m=e("./MediaTagReader");e("./MediaFileReader");e=function(a){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var a=Object.getPrototypeOf(b).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&
"function"!==typeof a?this:a}l(b,a);h(b,[{key:"_loadData",value:function(a,b){var g=a.getSize();a.loadRange([g-128,g-1],b)}},{key:"_parseData",value:function(a,b){var g=a.getSize()-128,p=a.getStringWithCharsetAt(g+3,30).toString(),n=a.getStringWithCharsetAt(g+33,30).toString(),e=a.getStringWithCharsetAt(g+63,30).toString(),u=a.getStringWithCharsetAt(g+93,4).toString(),r=a.getByteAt(g+97+28),t=a.getByteAt(g+97+29);if(0==r&&0!=t)var r="1.1",q=a.getStringWithCharsetAt(g+97,28).toString();else r="1.0",
q=a.getStringWithCharsetAt(g+97,30).toString(),t=0;g=a.getByteAt(g+97+30);p={type:"ID3",version:r,tags:{title:p,artist:n,album:e,year:u,comment:q,genre:255>g?f[g]:""}};t&&(p.tags.track=t);return p}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function(a){return"TAG"===String.fromCharCode.apply(String,a.slice(0,3))}}]);return b}(m);var f="Blues;Classic Rock;Country;Dance;Disco;Funk;Grunge;Hip-Hop;Jazz;Metal;New Age;Oldies;Other;Pop;R&B;Rap;Reggae;Rock;Techno;Industrial;Alternative;Ska;Death Metal;Pranks;Soundtrack;Euro-Techno;Ambient;Trip-Hop;Vocal;Jazz+Funk;Fusion;Trance;Classical;Instrumental;Acid;House;Game;Sound Clip;Gospel;Noise;AlternRock;Bass;Soul;Punk;Space;Meditative;Instrumental Pop;Instrumental Rock;Ethnic;Gothic;Darkwave;Techno-Industrial;Electronic;Pop-Folk;Eurodance;Dream;Southern Rock;Comedy;Cult;Gangsta;Top 40;Christian Rap;Pop/Funk;Jungle;Native American;Cabaret;New Wave;Psychadelic;Rave;Showtunes;Trailer;Lo-Fi;Tribal;Acid Punk;Acid Jazz;Polka;Retro;Musical;Rock & Roll;Hard Rock;Folk;Folk-Rock;National Folk;Swing;Fast Fusion;Bebob;Latin;Revival;Celtic;Bluegrass;Avantgarde;Gothic Rock;Progressive Rock;Psychedelic Rock;Symphonic Rock;Slow Rock;Big Band;Chorus;Easy Listening;Acoustic;Humour;Speech;Chanson;Opera;Chamber Music;Sonata;Symphony;Booty Bass;Primus;Porn Groove;Satire;Slow Jam;Club;Tango;Samba;Folklore;Ballad;Power Ballad;Rhythmic Soul;Freestyle;Duet;Punk Rock;Drum Solo;Acapella;Euro-House;Dance Hall".split(";");
k.exports=e},{"./FlowTypes":5,"./MediaFileReader":10,"./MediaTagReader":11}],7:[function(e,k,m){function l(a){var b;switch(a){case 0:b="iso-8859-1";break;case 1:b="utf-16";break;case 2:b="utf-16be";break;case 3:b="utf-8"}return b}e("./FlowTypes");e("./MediaFileReader");var h={APIC:function(a,b,c,d,g){g=g||"3";d=a;var p=l(c.getByteAt(a));switch(g){case "2":var n=c.getStringAt(a+1,3);a+=4;break;case "3":case "4":n=c.getStringWithCharsetAt(a+1,b-(a-d)),a+=1+n.bytesReadCount}g=c.getByteAt(a,1);g=f[g];
p=c.getStringWithCharsetAt(a+1,b-(a-d),p);a+=1+p.bytesReadCount;return{format:n.toString(),type:g,description:p.toString(),data:c.getBytesAt(a,d+b-a)}},COMM:function(a,b,c,d,g){var p=a,n=l(c.getByteAt(a));d=c.getStringAt(a+1,3);g=c.getStringWithCharsetAt(a+4,b-4,n);a+=4+g.bytesReadCount;a=c.getStringWithCharsetAt(a,p+b-a,n);return{language:d,short_description:g.toString(),text:a.toString()}}};h.COM=h.COMM;h.PIC=function(a,b,c,d,g){return h.APIC(a,b,c,d,"2")};h.PCNT=function(a,b,c,d,g){return c.getLongAt(a,
!1)};h.CNT=h.PCNT;h["T*"]=function(a,b,c,d,g){d=l(c.getByteAt(a));return c.getStringWithCharsetAt(a+1,b-1,d).toString()};h.TCON=function(a,b,c,d){return h["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")};h.TCO=h.TCON;h.USLT=function(a,b,c,d,g){var p=a,n=l(c.getByteAt(a));d=c.getStringAt(a+1,3);g=c.getStringWithCharsetAt(a+4,b-4,n);a+=4+g.bytesReadCount;a=c.getStringWithCharsetAt(a,p+b-a,n);return{language:d,descriptor:g.toString(),lyrics:a.toString()}};h.ULT=h.USLT;var f="Other;32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. label side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";");
k.exports={getFrameReaderFunction:function(a){return a in h?h[a]:"T"===a[0]?h["T*"]:null}}},{"./FlowTypes":5,"./MediaFileReader":10}],8:[function(e,k,m){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(c,g){for(var b=
0;b<g.length;b++){var n=g[b];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(c,n.key,n)}}return function(b,g,p){g&&a(b.prototype,g);p&&a(b,p);return b}}();e("./FlowTypes");m=e("./MediaTagReader");e("./MediaFileReader");var f=e("./ID3v2FrameReader");e=function(c){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var a=Object.getPrototypeOf(d).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}l(d,c);h(d,[{key:"_loadData",value:function(a,c){a.loadRange([6,9],{onSuccess:function(){a.loadRange([0,a.getSynchsafeInteger32At(6)],c)},onError:c.onError})}},{key:"_parseData",value:function(a,c){var d=0,f=a.getByteAt(d+3);if(4<f)return{type:"ID3",version:">2.4",tags:{}};var u=a.getByteAt(d+4),e=a.isBitSetAt(d+5,7),t=a.isBitSetAt(d+5,6),q=a.isBitSetAt(d+5,5),h=a.getSynchsafeInteger32At(d+6),d=d+10;if(t)var k=a.getLongAt(d,!0),d=d+(k+4);
var f={type:"ID3",version:"2."+f+"."+u,major:f,revision:u,flags:{unsynchronisation:e,extended_header:t,experimental_indicator:q,footer_present:!1},size:h,tags:{}},d=e?{}:this._readFrames(d,h-10,a,f,c),l;for(l in b)b.hasOwnProperty(l)&&(e=this._getFrameData(d,b[l]))&&(f.tags[l]=e);for(var m in d)d.hasOwnProperty(m)&&(f.tags[m]=d[m]);return f}},{key:"_readFrames",value:function(a,c,b,d,e){var r={};for(e&&(e=this._expandShortcutTags(e));a<c;){var h=this._readFrameHeader(b,a,d),q=h.id;if(0===h.size)break;
if(!q)break;var l=h.flags,k=h.size,m=a+h.headerSize;a+=h.headerSize+h.size;e&&-1===e.indexOf(q)||l&&l.format.unsynchronisation||(l&&l.format.data_length_indicator&&(m+=4,k-=4),l=(h=f.getFrameReaderFunction(q))?h(m,k,b,l):null,m=this._getFrameDescription(q),k={id:q,size:k,description:m,data:l},q in r?(r[q].id&&(r[q]=[r[q]]),r[q].push(k)):r[q]=k)}return r}},{key:"_readFrameHeader",value:function(a,c,b){b=b.major;var d=null;switch(b){case 2:var f=a.getStringAt(c,3),e=a.getInteger24At(c+3,!0),h=6;break;
case 3:f=a.getStringAt(c,4);e=a.getLongAt(c+4,!0);h=10;break;case 4:f=a.getStringAt(c,4),e=a.getSynchsafeInteger32At(c+4),h=10}f&&2<b&&(d=this._readFrameFlags(a,c+8));return{id:f,size:e,headerSize:h,flags:d}}},{key:"_readFrameFlags",value:function(a,c){return{message:{tag_alter_preservation:a.isBitSetAt(c,6),file_alter_preservation:a.isBitSetAt(c,5),read_only:a.isBitSetAt(c,4)},format:{grouping_identity:a.isBitSetAt(c+1,7),compression:a.isBitSetAt(c+1,3),encryption:a.isBitSetAt(c+1,2),unsynchronisation:a.isBitSetAt(c+
1,1),data_length_indicator:a.isBitSetAt(c+1,0)}}}},{key:"_getFrameData",value:function(a,c){for(var b=0,d;d=c[b];b++)if(d in a)return a[d].data}},{key:"_getFrameDescription",value:function(c){return c in a?a[c]:"Unknown"}},{key:"_expandShortcutTags",value:function(a){for(var c=[],d=0,f;f=a[d];d++)c=c.concat(b[f]||[f]);return c}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(a){return"ID3"===String.fromCharCode.apply(String,
a.slice(0,3))}}]);return d}(m);var a={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",
TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",
TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",
ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",
GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",
TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",
TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",
TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",
WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},b={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};k.exports=e},{"./FlowTypes":5,"./ID3v2FrameReader":7,"./MediaFileReader":10,
"./MediaTagReader":11}],9:[function(e,k,m){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(c,b){for(var f=0;f<b.length;f++){var e=b[f];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=
!0);Object.defineProperty(c,e.key,e)}}return function(b,g,f){g&&a(b.prototype,g);f&&a(b,f);return b}}();e("./FlowTypes");m=e("./MediaTagReader");e("./MediaFileReader");e=function(c){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var a=Object.getPrototypeOf(d).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}l(d,c);h(d,[{key:"_loadData",
value:function(a,c){var b=this;a.loadRange([0,16],{onSuccess:function(){b._loadAtom(a,0,"",c)},onError:c.onError})}},{key:"_loadAtom",value:function(a,c,b,d){if(c>=a.getSize())d.onSuccess();else{var f=this,e=a.getLongAt(c,!0);if(0==e||isNaN(e))d.onSuccess();else{var h=a.getStringAt(c+4,4);if(this._isContainerAtom(h)){"meta"==h&&(c+=4);var q=(b?b+".":"")+h;"moov.udta.meta.ilst"===q?a.loadRange([c,c+e],d):a.loadRange([c+8,c+8+8],{onSuccess:function(){f._loadAtom(a,c+8,q,d)},onError:d.onError})}else a.loadRange([c+
e,c+e+8],{onSuccess:function(){f._loadAtom(a,c+e,b,d)},onError:d.onError})}}}},{key:"_isContainerAtom",value:function(a){return 0<=["moov","udta","meta","ilst"].indexOf(a)}},{key:"_canReadAtom",value:function(a){return"----"!==a}},{key:"_parseData",value:function(a,c){var d={};this._readAtom(d,a,0,a.getSize(),c);for(var f in b)if(b.hasOwnProperty(f)){var e=d[b[f]];e&&(d[f]="track"===f?e.data.track:e.data)}return{type:"MP4",ftyp:a.getStringAt(8,4),version:a.getLongAt(12,!0),tags:d}}},{key:"_readAtom",
value:function(a,c,b,d,f,e,h){h=void 0===h?"":h+"  ";for(var q=b;q<b+d;){var l=c.getLongAt(q,!0);if(0==l)break;var k=c.getStringAt(q+4,4);if(this._isContainerAtom(k)){"meta"==k&&(q+=4);this._readAtom(a,c,q+8,l-8,f,(e?e+".":"")+k,h);break}(!f||0<=f.indexOf(k))&&"moov.udta.meta.ilst"===e&&this._canReadAtom(k)&&(a[k]=this._readMetadataAtom(c,q));q+=l}}},{key:"_readMetadataAtom",value:function(c,b){var d=c.getLongAt(b,!0),e=c.getStringAt(b+4,4),h=c.getInteger24At(b+16+1,!0),h=f[h],k;if("trkn"==e)k={track:c.getByteAt(b+
16+11),total:c.getByteAt(b+16+13)};else{var l=b+24,q=d-24;switch(h){case "text":k=c.getStringWithCharsetAt(l,q,"utf-8").toString();break;case "uint8":k=c.getShortAt(l,!1);break;case "jpeg":case "png":k={format:"image/"+h,data:c.getBytesAt(l,q)}}}return{id:e,size:d,description:a[e]||"Unknown",data:k}}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(a){return"ftyp"===String.fromCharCode.apply(String,a.slice(4,8))}}]);return d}(m);
var f={0:"uint8",1:"text",13:"jpeg",14:"png",21:"uint8"},a={"\u00a9alb":"Album","\u00a9ART":"Artist",aART:"Album Artist","\u00a9day":"Release Date","\u00a9nam":"Title","\u00a9gen":"Genre",gnre:"Genre",trkn:"Track Number","\u00a9wrt":"Composer","\u00a9too":"Encoding Tool","\u00a9enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","\u00a9grp":"Grouping",keyw:"Keywords","\u00a9lyr":"Lyrics","\u00a9cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",
tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code"},b={title:"\u00a9nam",artist:"\u00a9ART",album:"\u00a9alb",year:"\u00a9day",comment:"\u00a9cmt",track:"trkn",genre:"\u00a9gen",
picture:"covr",lyrics:"\u00a9lyr"};k.exports=e},{"./FlowTypes":5,"./MediaFileReader":10,"./MediaTagReader":11}],10:[function(e,k,m){var l=function(){function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,b,c){b&&f(a.prototype,b);c&&f(a,c);return a}}();e("./StringUtils");e("./FlowTypes");var h=e("./StringUtils");e=function(){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");
this._isInitialized=!1;this._size=0}l(f,[{key:"init",value:function(a){var b=this;if(this._isInitialized)setTimeout(a.onSuccess,1);else return this._init({onSuccess:function(){b._isInitialized=!0;a.onSuccess()},onError:a.onError})}},{key:"_init",value:function(a){throw Error("Must implement init function");}},{key:"loadRange",value:function(a,b){throw Error("Must implement loadRange function");}},{key:"getSize",value:function(){if(!this._isInitialized)throw Error("init() must be called first.");return this._size}},
{key:"getByteAt",value:function(a){throw Error("Must implement getByteAt function");}},{key:"getBytesAt",value:function(a,b){for(var c=Array(b),d=0;d<b;d++)c[d]=this.getByteAt(a+d);return c}},{key:"isBitSetAt",value:function(a,b){return 0!=(this.getByteAt(a)&1<<b)}},{key:"getSByteAt",value:function(a){a=this.getByteAt(a);return 127<a?a-256:a}},{key:"getShortAt",value:function(a,b){var c=b?(this.getByteAt(a)<<8)+this.getByteAt(a+1):(this.getByteAt(a+1)<<8)+this.getByteAt(a);0>c&&(c+=65536);return c}},
{key:"getSShortAt",value:function(a,b){var c=this.getShortAt(a,b);return 32767<c?c-65536:c}},{key:"getLongAt",value:function(a,b){var c=this.getByteAt(a),d=this.getByteAt(a+1),f=this.getByteAt(a+2),e=this.getByteAt(a+3),c=b?(((c<<8)+d<<8)+f<<8)+e:(((e<<8)+f<<8)+d<<8)+c;0>c&&(c+=4294967296);return c}},{key:"getSLongAt",value:function(a,b){var c=this.getLongAt(a,b);return 2147483647<c?c-4294967296:c}},{key:"getInteger24At",value:function(a,b){var c=this.getByteAt(a),d=this.getByteAt(a+1),f=this.getByteAt(a+
2),c=b?((c<<8)+d<<8)+f:((f<<8)+d<<8)+c;0>c&&(c+=16777216);return c}},{key:"getStringAt",value:function(a,b){for(var c=[],d=a,f=0;d<a+b;d++,f++)c[f]=String.fromCharCode(this.getByteAt(d));return c.join("")}},{key:"getStringWithCharsetAt",value:function(a,b,c){a=this.getBytesAt(a,b);switch((c||"").toLowerCase()){case "utf-16":case "utf-16le":case "utf-16be":c=h.readUTF16String(a,"utf-16be"===c);break;case "utf-8":c=h.readUTF8String(a);break;default:c=h.readNullTerminatedString(a)}return c}},{key:"getCharAt",
value:function(a){return String.fromCharCode(this.getByteAt(a))}},{key:"getSynchsafeInteger32At",value:function(a){var b=this.getByteAt(a),c=this.getByteAt(a+1),d=this.getByteAt(a+2);return this.getByteAt(a+3)&127|(d&127)<<7|(c&127)<<14|(b&127)<<21}}],[{key:"canReadFile",value:function(a){throw Error("Must implement canReadFile function");}}]);return f}();k.exports=e},{"./FlowTypes":5,"./StringUtils":12}],11:[function(e,k,m){var l=function(){function e(f,a){for(var b=0;b<a.length;b++){var c=a[b];
c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(f,c.key,c)}}return function(f,a,b){a&&e(f.prototype,a);b&&e(f,b);return f}}();e("./FlowTypes");e("./MediaFileReader");e=function(){function e(f){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._mediaFileReader=f;this._tags=null}l(e,[{key:"setTagsToRead",value:function(f){this._tags=f;return this}},{key:"read",value:function(f){var a=this;this._mediaFileReader.init({onSuccess:function(){a._loadData(a._mediaFileReader,
{onSuccess:function(){var b=a._parseData(a._mediaFileReader,a._tags);f.onSuccess(b)},onError:f.onError})},onError:f.onError})}},{key:"_loadData",value:function(f,a){throw Error("Must implement _loadData function");}},{key:"_parseData",value:function(f,a){throw Error("Must implement _parseData function");}}],[{key:"getTagIdentifierByteRange",value:function(){throw Error("Must implement");}},{key:"canReadTagFormat",value:function(f){throw Error("Must implement");}}]);return e}();k.exports=e},{"./FlowTypes":5,
"./MediaFileReader":10}],12:[function(e,k,m){var l=function(){function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,b,c){b&&f(a.prototype,b);c&&f(a,c);return a}}(),h=function(){function f(a,b){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this._value=a;this.bytesReadCount=b;this.length=a.length}l(f,[{key:"toString",value:function(){return this._value}}]);
return f}();k.exports={readUTF16String:function(f,a,b){var c=0,d=1,g=0;b=Math.min(b||f.length,f.length);254==f[0]&&255==f[1]?(a=!0,c=2):255==f[0]&&254==f[1]&&(a=!1,c=2);a&&(d=0,g=1);a=[];for(var e=0;c<b;e++){var k=f[c+d],l=(k<<8)+f[c+g],c=c+2;if(0==l)break;else 216>k||224<=k?a[e]=String.fromCharCode(l):(k=(f[c+d]<<8)+f[c+g],c+=2,a[e]=String.fromCharCode(l,k))}return new h(a.join(""),c)},readUTF8String:function(f,a){var b=0;a=Math.min(a||f.length,f.length);239==f[0]&&187==f[1]&&191==f[2]&&(b=3);for(var c=
[],d=0;b<a;d++){var e=f[b++];if(0==e)break;else if(128>e)c[d]=String.fromCharCode(e);else if(194<=e&&224>e){var k=f[b++];c[d]=String.fromCharCode(((e&31)<<6)+(k&63))}else if(224<=e&&240>e){var k=f[b++],l=f[b++];c[d]=String.fromCharCode(((e&255)<<12)+((k&63)<<6)+(l&63))}else if(240<=e&&245>e){var k=f[b++],l=f[b++],m=f[b++],e=((e&7)<<18)+((k&63)<<12)+((l&63)<<6)+(m&63)-65536;c[d]=String.fromCharCode((e>>10)+55296,(e&1023)+56320)}}return new h(c.join(""),b)},readNullTerminatedString:function(f,a){var b=
[];a=a||f.length;for(var c=0;c<a;){var d=f[c++];if(0==d)break;b[c-1]=String.fromCharCode(d)}return new h(b.join(""),c)}}},{}],13:[function(e,k,m){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,c){for(var d=
0;d<c.length;d++){var f=c[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();e("./FlowTypes");var f=e("./ChunkedFileData");m=function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var d;d=Object.getPrototypeOf(b).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=
!d||"object"!==typeof d&&"function"!==typeof d?this:d;d._url=a;d._fileData=new f;return d}l(b,a);h(b,[{key:"_init",value:function(a){var b=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(f){b._size=parseInt(f.getResponseHeader("Content-Length"),10);a.onSuccess()},onError:a.onError})}},{key:"loadRange",value:function(a,b){var f=this;f._fileData.hasDataRange(a[0],a[1])?setTimeout(b.onSuccess,1):(a=this._roundRangeToChunkMultiple(a),this._makeXHRRequest("GET",a,{onSuccess:function(e){f._fileData.addData(a[0],
e.responseBody||e.responseText);b.onSuccess()},onError:b.onError}))}},{key:"_roundRangeToChunkMultiple",value:function(a){return[a[0],a[0]+1024*Math.ceil((a[1]-a[0]+1)/1024)-1]}},{key:"_makeXHRRequest",value:function(a,b,f){var e=this._createXHRObject(),h=function(){if(200===e.status||206===e.status)f.onSuccess(e);else if(f.onError)f.onError({type:"xhr",info:"Unexpected HTTP status "+e.status+".",xhr:e});e=null};"undefined"!==typeof e.onload?(e.onload=h,e.onerror=function(){if(f.onError)f.onError({type:"xhr",
info:"Generic XHR error, check xhr object.",xhr:e})}):e.onreadystatechange=function(){4===e.readyState&&h()};e.open(a,this._url);e.overrideMimeType("text/plain; charset=x-user-defined");b&&e.setRequestHeader("Range","bytes="+b[0]+"-"+b[1]);e.setRequestHeader("If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT");e.send(null)}},{key:"getByteAt",value:function(a){return this._fileData.getByteAt(a).charCodeAt(0)&255}},{key:"_createXHRObject",value:function(){if("undefined"===typeof window)return new (e("xhr2").XMLHttpRequest);
if(window.XMLHttpRequest)return new window.XMLHttpRequest;throw Error("XMLHttpRequest is not supported");}}],[{key:"canReadFile",value:function(a){return"string"===typeof a&&/^[a-z]+:\/\//i.test(a)}}]);return b}(e("./MediaFileReader"));k.exports=m},{"./ChunkedFileData":4,"./FlowTypes":5,"./MediaFileReader":10,xhr2:2}],14:[function(e,k,m){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var h=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=
c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();e("./FlowTypes");e("./MediaFileReader");m=e("./NodeFileReader");var f=e("./XhrFileReader"),a=e("./BlobFileReader");e("./MediaTagReader");var b=e("./ID3v1TagReader"),c=e("./ID3v2TagReader");e=e("./MP4TagReader");var d=[],g=[],p=function(){function a(b){l(this,a);this._file=b}h(a,[{key:"setTagsToRead",value:function(a){this._tagsToRead=
a;return this}},{key:"setFileReader",value:function(a){this._fileReader=a;return this}},{key:"setTagReader",value:function(a){this._tagReader=a;return this}},{key:"read",value:function(a){var b=new (this._getFileReader())(this._file),c=this;b.init({onSuccess:function(){c._getTagReader(b,{onSuccess:function(d){(new d(b)).setTagsToRead(c._tagsToRead).read(a)},onError:a.onError})},onError:a.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},
{key:"_findFileReader",value:function(){for(var a=0;a<d.length;a++)if(d[a].canReadFile(this._file))return d[a];throw Error("No suitable file reader found for ",this._file);}},{key:"_getTagReader",value:function(a,b){if(this._tagReader){var c=this._tagReader;setTimeout(function(){b.onSuccess(c)},1)}else this._findTagReader(a,b)}},{key:"_findTagReader",value:function(a,b){for(var c=[],d=[],e=a.getSize(),f=0;f<g.length;f++){var h=g[f].getTagIdentifierByteRange();0<=h.offset&&h.offset<e/2||0>h.offset&&
h.offset<-e/2?c.push(g[f]):d.push(g[f])}var k=!1,f={onSuccess:function(){if(k){for(var c=0;c<g.length;c++){var d=g[c].getTagIdentifierByteRange(),d=a.getBytesAt(0<=d.offset?d.offset:d.offset+e,d.length);if(g[c].canReadTagFormat(d)){b.onSuccess(g[c]);return}}if(b.onError)b.onError({type:"tagFormat",info:"No suitable tag reader found"})}else k=!0},onError:b.onError};this._loadTagIdentifierRanges(a,c,f);this._loadTagIdentifierRanges(a,d,f)}},{key:"_loadTagIdentifierRanges",value:function(a,b,c){if(0===
b.length)setTimeout(c.onSuccess,1);else{for(var d=[Number.MAX_VALUE,0],e=a.getSize(),f=0;f<b.length;f++){var g=b[f].getTagIdentifierByteRange(),h=0<=g.offset?g.offset:g.offset+e,g=h+g.length-1;d[0]=Math.min(h,d[0]);d[1]=Math.max(g,d[1])}a.loadRange(d,c)}}}]);return a}(),n=function(){function a(){l(this,a)}h(a,null,[{key:"addFileReader",value:function(a){d.push(a);return this}},{key:"addTagReader",value:function(a){g.push(a);return this}},{key:"removeTagReader",value:function(a){a=g.indexOf(a);0<=
a&&g.splice(a,1);return this}}]);return a}();n.addFileReader(f).addFileReader(a).addTagReader(c).addTagReader(b).addTagReader(e);"undefined"!==typeof process&&n.addFileReader(m);k.exports={read:function(a,b){(new p(a)).read(b)},Reader:p,Config:n}},{"./BlobFileReader":3,"./FlowTypes":5,"./ID3v1TagReader":6,"./ID3v2TagReader":8,"./MP4TagReader":9,"./MediaFileReader":10,"./MediaTagReader":11,"./NodeFileReader":1,"./XhrFileReader":13}]},{},[14])(14)});
